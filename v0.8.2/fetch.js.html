<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>m3api: Source: fetch.js</title>

    <script defer src="scripts/prettify/prettify.js"></script>
    <script defer src="scripts/prettify/lang-css.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <link type="text/css" rel="stylesheet" href="version-warning.css">
</head>

<body>

<div id="main">

    <p class="version-warning"><strong>Warning:</strong> This is an old version. The latest stable version is <a href="../v0.8.4/fetch.js.html">v0.8.4</a>.</p>

    <h1 class="page-title">Source: fetch.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* eslint-env browser */

import { Session } from './core.js';

async function transformResponse( response ) {
	const headers = {};
	for ( const [ name, value ] of response.headers.entries() ) {
		headers[ name ] = value;
	}

	return {
		status: response.status,
		headers,
		body: await response.json(),
	};
}

class FetchSession extends Session {

	constructor( apiUrl, defaultParams = {}, defaultOptions = {} ) {
		super( apiUrl, defaultParams, defaultOptions );
		this.fetchOptions = {};
	}

	/**
	 * Get the fetch() options for this request.
	 *
	 * @protected
	 * @param {Object} headers
	 * @return {Object}
	 */
	getFetchOptions( headers ) {
		return { headers };
	}

	async internalGet( apiUrl, params, headers ) {
		const url = new URL( apiUrl );
		url.search = new URLSearchParams( params );
		const response = await fetch( url, {
			...this.getFetchOptions( headers ),
		} );
		return transformResponse( response );
	}

	async internalPost( apiUrl, urlParams, bodyParams, headers ) {
		const url = new URL( apiUrl );
		url.search = new URLSearchParams( urlParams );
		const body = new FormData();
		for ( const [ paramName, paramValue ] of Object.entries( bodyParams ) ) {
			body.append( paramName, paramValue );
		}
		const response = await fetch( url, {
			...this.getFetchOptions( headers ),
			method: 'POST',
			body,
		} );
		return transformResponse( response );
	}

}

export {
	FetchSession,
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ApiErrors.html">ApiErrors</a></li><li><a href="ApiWarnings.html">ApiWarnings</a></li><li><a href="DefaultUserAgentWarning.html">DefaultUserAgentWarning</a></li><li><a href="Session.html">Session</a></li></ul><h3>Global</h3><ul><li><a href="global.html#DEFAULT_OPTIONS">DEFAULT_OPTIONS</a></li><li><a href="global.html#makeWarnDroppingTruncatedResultWarning">makeWarnDroppingTruncatedResultWarning</a></li><li><a href="global.html#responseBoolean">responseBoolean</a></li><li><a href="global.html#set">set</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a>
</footer>

<script>document.addEventListener('DOMContentLoaded', function () { prettyPrint(); });</script>
<script async src="scripts/linenumber.js"></script>
</body>
</html>
